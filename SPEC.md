# 간호사 번표 자동 작성 프로그램 기획서

4주 근무 스케줄 자동 생성 및 관리 시스템

## 📋 프로젝트 개요

간호사 근무표를 자동으로 생성하는 웹 애플리케이션입니다. 다양한 제약 조건을 준수하면서 공평한 근무 배분을 목표로 합니다.

## 📅 주요 개념

### 1주의 정의

**본 프로그램에서 1주는 일요일부터 토요일까지를 의미합니다.**

- **주 시작**: 일요일
- **주 종료**: 토요일
- **주간 휴식 규칙**: 일~토 기준으로 계산
- **주휴일**: 각 간호사가 지정한 요일 (일~토 중 1일)

이는 일반적인 월~일 기준과 다르므로 주의가 필요합니다.

## 🛠 기술 스택

- **Frontend**: React 19.1.1 + TypeScript
- **Build Tool**: Vite
- **Styling**: CSS

## 🚀 실행 방법

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 빌드
npm run build

# 테스트 실행
npm run test              # 일반 테스트
npm run test:ui           # UI로 테스트
npm run test:verbose      # 상세 출력 테스트 (권장)
```

### ✅ 최종 검증 절차

**코드 수정 후 반드시 다음 명령어로 전체 테스트를 실행하여 검증합니다:**

```bash
npm run test:verbose
```

- 모든 테스트(56개)가 통과해야 합니다
- 실패 시 코드 또는 테스트를 수정하고 다시 실행
- 성공할 때까지 반복

---

## 💡 주요 기능

### 1. 간호사 관리

- 간호사 추가/수정/삭제
- 개인별 주휴일(요일) 설정
- 초기 15명 세팅 (주휴일 라운드로빈 배정)

### 2. 스케줄 관리

- **날짜 범위 설정**
  - **기본값**: 가장 빠른 일요일부터 4주(28일) 자동 설정
    - 예: 오늘이 수요일이면 → 다음 일요일 ~ 4주 후 토요일
    - 예: 오늘이 일요일이면 → 오늘 ~ 4주 후 토요일
  - 시작일/종료일 수동 변경 가능
  - 동적 일수 계산 및 표시
- **셀 클릭**: 근무 타입 변경 (D → M → E → N → OFF → 주휴 → 연차)
- **셀 우클릭**: 고정/고정 해제 (고정된 셀은 검은 테두리 표시)
- 날짜별 근무 인원 실시간 표시 (색상으로 부족/충족/초과 표시)

### 3. 자동 생성

- **자동 생성 버튼**: 제약 조건을 만족하는 스케줄 자동 생성
- **재생성 기능**: 버튼을 여러 번 누르면 매번 **다른 스케줄** 생성
  - 같은 조건이라도 매번 다양한 조합의 스케줄 제공
  - 마음에 드는 스케줄이 나올 때까지 재생성 가능
- 공평한 근무 분배 알고리즘
- 고정된 셀은 유지하고 나머지만 재배정

**💡 Tip**: 자동 생성 버튼을 여러 번 눌러보면서 가장 적합한 스케줄을 선택하세요!

### 4. 제약 조건 검증

- 실시간 제약 조건 위반 감지
- 하드 제약/소프트 제약 구분 표시
- 위반 내역 상세 보기 (더보기/접기 기능)

---

## 📐 제약 조건

### 🔴 하드 제약 조건 (반드시 지켜야 함)

#### 1. 일일 필수 인원

각 근무조별 필수 인원을 반드시 충족해야 합니다.

- **D (데이)**: 3명 **필수** (반드시 충족)
- **E (이브닝)**: 3명 **필수** (반드시 충족)
- **N (나이트)**: 2명 **필수** (반드시 충족)
- **M (중간)**: 1명 **권장** (최선을 다하지만 불가능하면 0명 허용)
- **총 9명**의 근무자 권장 (D, E, N만 필수이므로 최소 8명)

**💡 M(중간 근무) 특별 규칙**:
- **D, E, N은 무조건 필수 인원 충족** (최우선)
- M은 D 직후 배정하여 성공률 극대화
- 할당 순서: **D → M → N → E** (M은 D 다음 사람 중 선택)
- M=0은 정말 불가능한 경우에만 발생 (거의 발생하지 않음)
- M=0이어도 D, E, N이 충족되면 하드 제약 위반 없음

#### 2. 근무 순서 규칙

근무는 정해진 순서를 따라야 하며, 역순은 불가합니다.

- **허용되는 순서**: D → M → E → N → 휴일
- 같은 근무 연속 가능 (예: D → D → D)
- 건너뛰기 가능 (예: D → E, M → N)
- ❌ **역순 불가** (예: E → D, N → E, E → M 불가)
- 휴일 후에는 순서대로 근무 가능
- 예를 들어, 휴일 -> E -> N 가능
- 예를 들어, 휴일 -> D -> E 가능. 순서를 지켜야 한다.
- 예를 들어, M -> 휴일 -> D 도 가능.
- 중간에 휴가가 끼면 순서 초기화 가능

#### 3. 나이트 근무 규칙

나이트 근무는 특별한 규칙을 따릅니다.

- ✅ **2일 또는 3일 연속**만 가능 (1일만 또는 4일 이상 불가)
- ✅ 나이트 1일차 후: 반드시 2일차 계속
- ✅ 나이트 2일차 후: 3일차 계속 또는 휴식
  - 알고리즘에서 70% 확률로 3일차 진행 (randomize=true), 100% 3일차 진행 (randomize=false)
- ✅ 나이트 3일차 후: 반드시 종료
- ✅ 주휴일 충돌 방지: 나이트 시작 시 향후 2일 동안 주휴일이 없는 간호사만 배정
- ✅ 나이트 근무 후 **2일 이상 연속 휴식** 필수 (검증 + 자동 배정 완료)

#### 4. 연속 근무일 제한

과도한 연속 근무를 방지합니다.

- 최대 **5일 연속 근무**까지만 가능
- 6일 이상 연속 근무 불가

#### 5. 주간 휴식 규칙 (일~토 기준)

매주 적절한 휴식을 보장합니다.

- **주휴(WEEK_OFF)**: 정확히 1일 (본인 지정 요일) - 필수
- **OFF**: 최소 1일 - 필수
- **연차/생휴**: 추가 옵션 (있으면 총 휴일이 3일 이상이 됨)
- **총 휴일**: 최소 2일 이상 (주휴 1일 + OFF 1일 필수, 연차/생휴는 추가)

#### 6. 연차 신청 규칙

간호사가 신청한 연차는 엄격하게 보호됩니다.

- ✅ **주휴일과 연차 겹침 금지**: 주휴일과 같은 요일에는 연차 신청 불가
  - 예: 주휴일이 일요일인 간호사는 일요일에 연차 신청 불가
  - 신청 시 즉시 검증하여 에러 메시지 표시
- ✅ **스케줄에 자동 반영**: 신청한 연차는 스케줄에 "A" (연차OFF)로 표시
- ✅ **수정 불가능**: 연차OFF는 자동으로 고정 (isFixed: true)
  - 클릭해도 변경되지 않음
  - 자동 생성 시에도 연차는 그대로 유지
- 연차 삭제: 간호사 관리 페이지에서 × 버튼으로 삭제 가능

#### 7. 고정 근무/휴가

사용자가 수동으로 설정한 일정은 보호됩니다.

- 주휴일(WEEK_OFF)은 자동으로 고정됨 (isFixed: true)
- 연차(ANNUAL)도 자동으로 고정됨 (isFixed: true)
- 고정된 셀은 클릭해도 변경되지 않음
- 향후 우클릭으로 사용자가 수동으로 고정/해제 가능 (구현 예정)

---

### 🟡 소프트 제약 조건 (권장사항)

#### 1. 비권장 패턴

- **E → OFF → D** 패턴 비권장
  - 가능은 하지만 권장하지 않음

#### 2. 휴일 공평 분배

간호사들 간의 휴일 수 차이를 최소화합니다.

- 간호사별 총 휴일 수 차이 최대 1일 이내 권장
- 차이 2일: 소프트 위반
- 차이 3일 이상: 하드 위반

#### 3. 근무 공평 분배

근무 부담을 균등하게 분산합니다.

- 총 근무일이 적은 간호사 우선 배정
- 근무 부담이 특정 간호사에게 쏠리지 않도록 조정

#### 4. 나이트 근무 공평 분배

4주 동안 총 나이트 일수가 간호사들끼리 평균 2일 이상 차이가 나지 않게한다.
ex) 간호사 A는 나이트 4일, 간호사 B는 나이트6일까지는 괜찮음
ex) 간호사 A는 나이트 4일, 간호사 B는 나이트7일은 권장하지 않음

#### 5. 2주 연속 나이트 근무 제한

간호사의 피로도를 고려하여 2주 연속 나이트 근무는 권장하지 않습니다.

- 연속된 2주(일~토)에 모두 나이트 근무가 있으면 SOFT 위반
- 인력 부족 시 불가피하게 발생할 수 있음 (현직 간호사 피드백)
- 위반 시 노란색으로 경고만 표시
- 예시:
  - ⚠️ 1주차(1/1~1/7)에 나이트 2일 + 2주차(1/8~1/14)에 나이트 2일 → SOFT 위반
  - ✅ 1주차(1/1~1/7)에 나이트 2일 + 2주차 건너뛰고 3주차(1/15~1/21)에 나이트 2일 → 정상



---

## 🔄 스케줄 생성 알고리즘

### 배정 순서

스케줄은 다음 순서로 생성됩니다:

1. **고정된 셀 유지**
   - `isFixed=true`인 셀은 변경 안 함

2. **나이트 연속 처리**
   - 이미 나이트 중인 간호사 우선 처리

3. **새로운 나이트 배정**
   - 2명, 제약 조건 만족하는 간호사 중 근무일 적은 순

4. **데이 배정**
   - 3명

5. **중간 배정**
   - 1명, D 또는 M 다음만 가능

6. **이브닝 배정**
   - 3명, D, M, E 다음만 가능

7. **나머지는 휴일**
   - 주휴일 자동 배정

### 공평 분배 메커니즘

- `totalWorkDays` 추적: 각 간호사의 총 근무일 수 계산
- 근무 배정 시 `totalWorkDays`가 적은 간호사 우선 선택
- 모든 근무 타입(D, M, E, N)에 동일하게 적용

### 제약 조건 검증

- 실시간으로 제약 조건 위반 여부 검증
- 하드 제약 위반 우선 표시
- 위반 내역: 간호사명, 날짜, 사유 상세 표시

---

## 📊 근무 타입

| 타입      | 한글명 | 설명                   | 우선순위 |
| --------- | ------ | ---------------------- | -------- |
| D         | 데이   | 주간 근무              | 1        |
| M         | 중간   | 중간 근무 (선택적)     | 2        |
| E         | 이브닝 | 저녁 근무              | 3        |
| N         | 나이트 | 야간 근무 (2-3일 연속) | 4        |
| OFF       | 오프   | 일반 휴무              | -        |
| WEEK_OFF  | 주휴   | 주휴일 (지정 요일)     | -        |
| ANNUAL    | 연차   | 연차 휴가              | -        |
| MENSTRUAL | 생휴   | 생리 휴가              | -        |

---

## 📁 파일 구조

```
src/
├── types.ts                    # 타입 정의
├── constants.ts                # 상수 정의 (일일 필요 인원, 근무 타입 등)
├── App.tsx                     # 메인 앱 (탭 관리)
├── App.css                     # 전역 스타일
├── components/
│   ├── NurseManagement.tsx     # 간호사 관리 UI
│   └── ScheduleView.tsx        # 스케줄 뷰 UI
└── utils/
    ├── scheduler.ts            # 스케줄 생성 알고리즘
    └── validator.ts            # 제약 조건 검증
```

---

## 📖 사용 방법

### 1. 간호사 등록

1. "간호사 관리" 탭으로 이동
2. 간호사 이름 입력 및 주휴일 선택
3. "추가" 버튼 클릭
4. **수정**: "수정" 버튼 클릭 후 정보 변경 → "저장"
5. **삭제**: "삭제" 버튼 클릭

### 2. 스케줄 생성

1. "스케줄 관리" 탭으로 이동
2. 시작일/종료일 설정
3. 고정할 근무/휴가가 있다면:
   - 셀 클릭으로 근무 타입 변경
   - 우클릭으로 고정 (검은 테두리 표시)
4. "자동 생성" 버튼 클릭
5. 생성된 스케줄 확인 및 제약 조건 위반 확인

### 3. 수동 조정

- **셀 클릭**: 근무 타입 순환 변경
- **셀 우클릭**: 고정/해제 토글
- 고정된 셀은 자동 생성 시 변경되지 않음

---

## 🔧 개발 정보

### 구현 상태

#### ✅ 완료된 기능

1. **간호사 관리**
   - 추가/삭제 기능
   - 이름 및 주휴일 인라인 수정
   - 기본 15명 세팅 (주휴일 라운드로빈)

2. **스케줄 테이블 UI**
   - 날짜별 간호사 근무 배정
   - 셀 클릭으로 근무 타입 순환 변경
   - 간호사별/날짜별 통계 표시
   - 주말 표시 (빨간색)

3. **자동 생성 기능**
   - 일일 필수 인원 충족 (D: 3, M: 1, E: 3, N: 2)
   - 근무 순서 규칙 준수 (D → M → E → N)
   - 공평한 근무 분배 (근무 횟수 기반)
   - 매번 다른 스케줄 생성 (랜덤 요소)

4. **제약 조건 검증**
   - 일일 필수 인원 검증 (색상 표시: 부족/충족/초과)
   - 근무 순서 규칙 검증 (역순 방지)
   - 연속 근무일 제한 검증 (최대 5일 연속 근무)
   - 위반 셀 시각적 표시 (빨간 테두리)
   - 툴팁으로 위반 내용 표시

5. **자동 생성 개선**
   - 연속 근무일 제한 준수 (최대 5일)
   - 5일 연속 근무 시 자동으로 휴식 배정
   - 연속 근무일 추적 및 자동 리셋
   - 주휴일 자동 배정 (간호사별 지정 요일에 WEEK_OFF 고정)

6. **고정 셀 기능**
   - 주휴일은 자동으로 고정 (isFixed: true)
   - 고정된 셀은 클릭해도 변경 불가
   - 고정된 셀은 검은 테두리로 표시
   - 툴팁에 "(고정)" 표시

7. **개인 연차 신청 기능** ✅
   - 간호사 관리 탭에서 연차 날짜 선택 가능
   - 날짜 선택기로 연차 신청 (여러 날짜 가능)
   - 신청한 연차 목록 파란색 태그로 표시
   - × 버튼으로 연차 삭제 가능
   - 스케줄 생성 시 연차 날짜는 "연차OFF"로 자동 고정 배정 (isFixed: true)
   - Nurse 타입에 `annualLeaveDates: string[]` 필드 추가

8. **셀 레이블 개선** ✅
   - 일반 OFF: "OFF"
   - 주휴일: "주휴OFF" (구분 명확)
   - 연차: "연차OFF" (구분 명확)
   - 생리휴가: "생휴"

#### ✅ 최근 완료 (나이트 2-3일 연속 규칙 및 연차 기능)

1. **나이트 2-3일 연속 규칙** ✅ (완료!)
   - ✅ **검증 함수**: `validateNightBlockLength` (src/utils/validator.ts:222-304)
     - 나이트 1일만 근무 시 위반 감지 (단, 스케줄 마지막 날 예외)
     - 나이트 4일 이상 연속 시 위반 감지
     - 2-3일 연속은 정상 판정
     - **스케줄 마지막 날 예외**: 다음 스케줄로 이어질 수 있으므로 검증 제외
   - ✅ **생성 로직**: 나이트 블록 상태 관리 (src/utils/scheduler.ts:64-68, 183-273)
     - `nightBlockStatus` 추적: 0(나이트 아님), 1(1일차), 2(2일차), 3(3일차)
     - 나이트 1일차 → 반드시 2일차 계속
     - 나이트 2일차 → 마지막 날이거나 N 부족 시 무조건 3일차, 아니면 70% 확률 (randomize=true)
     - 나이트 3일차 → 반드시 종료
     - 주휴일 충돌 방지: 향후 2일 동안 주휴일이 없는 간호사만 배정
     - 기간 종료 고려: 최소 2일이 남아있을 때만 새로운 나이트 시작
     - **마지막 날 N 부족 해결**: 마지막 날에 N 부족 시 1일 나이트도 허용 (긴급 조치)
   - ✅ **테스트**: 모든 테스트 통과 (43/43, 500회 반복 테스트 포함)
   - ✅ **문서화**: SPEC.md 업데이트 완료

2. **개인 연차 신청 기능** ✅ (완료!)
   - ✅ **타입 정의**: Nurse 타입에 `annualLeaveDates: string[]` 추가 (src/types.ts:12)
   - ✅ **UI 구현**: 간호사 관리 탭에 연차 신청 컬럼 추가 (src/components/NurseManagement.tsx:167-195)
     - 날짜 선택기로 연차 날짜 선택
     - 선택한 연차 목록 파란색 태그로 표시
     - × 버튼으로 연차 삭제 가능
   - ✅ **스케줄 생성**: 연차 고정 배정 (src/utils/scheduler.ts:129-141)
     - 연차 신청한 날짜는 ANNUAL 타입으로 자동 배정
     - isFixed: true로 고정 (클릭해도 변경 불가)
   - ✅ **테스트**: 연차 관련 테스트 3개 추가 및 통과
     - 연차 신청한 날짜 ANNUAL 배정 테스트
     - 연차 없을 때 정상 동작 테스트
     - 여러 간호사 동시 연차 신청 테스트

#### ✅ 최근 완료 (나이트 후 2일 휴식 규칙)

1. **나이트 후 2일 휴식 규칙** ✅ (완료!)
   - ✅ **검증 함수**: `validateNightRestDays` (src/utils/validator.ts:293-360, 507-511)
     - 나이트 종료 후 2일 연속 휴식 검증
     - 스케줄 끝이어도 검증 (바로 근무 시 위반)
   - ✅ **자동 배정 로직**: (src/utils/scheduler.ts:70-74, 110-123, 249, 252, 394-403)
     - `nightRestDaysRemaining` 추적 변수로 남은 휴식일 수 관리
     - canWork 함수에 나이트 후 휴식 체크 추가
     - 나이트 2일차/3일차 종료 시 자동으로 2일 휴식 배정
     - 주휴일/연차와 조합해도 올바르게 작동
   - ✅ **테스트**: 8개 추가 (src/utils/validator.test.ts:600-718)
   - ✅ **전체 테스트**: 51/51 통과 (500회 반복 테스트 포함)

3. **2주 연속 나이트 제한 (SOFT)** ✅ (완료!)
   - ✅ **검증 함수**: `validateNightTwoWeekLimit` (src/utils/validator.ts:364-426, 579-583)
     - 주 단위(일~토)로 그룹화하여 나이트 근무 여부 확인
     - 연속된 2주에 모두 나이트가 있으면 SOFT 위반 반환
     - 예: 1주차 나이트 → 2주차 나이트 → SOFT 위반
     - 예: 1주차 나이트 → 2주차 스킵 → 3주차 나이트 → 정상
   - ✅ **테스트**: 5개 추가 (src/utils/validator.test.ts:721-854)
     - 1주만 나이트: 정상
     - 2주 연속 나이트: SOFT 위반 1개
     - 3주 연속 나이트: SOFT 위반 2개
     - 1주 건너뛰고 나이트: 정상
     - 나이트 없음: 정상
   - ✅ **통합 테스트 수정**: AND 조건 테스트들을 HARD 위반만 체크하도록 수정
   - ✅ **전체 테스트**: 56/56 통과 (500회 반복 테스트 포함)
   - ✅ **문서화**: SPEC.md 소프트 제약에 추가 완료

#### 🚧 구현 예정

2. **주간 휴식 규칙 검증** ✅
   - ✅ 주휴일 1일 자동 배정 완료
   - ✅ 주간 최소 휴일 검증 완료 (주휴 1일 + OFF/연차/생휴 최소 1일 = 총 2일 이상)
   - ✅ 토요일에 주간 휴일 0인 간호사 자동 OFF 배정
   - ✅ 불완전한 주(7일 미만) 검증 제외 처리

3. **우클릭 고정/해제 기능**
   - 우클릭으로 사용자가 수동으로 고정/해제 가능
   - 자동 생성 시 고정된 셀 유지

### 주요 파일 및 함수

#### 1. `src/utils/scheduler.ts`

**`generateSimpleSchedule(nurses, startDate, endDate)`**
- 간단한 자동 스케줄 생성
- 일일 필수 인원 충족
- 근무 순서 준수 (D → M → E → N)
- 공평한 근무 분배 (근무 카운트 기반)
- 연속 근무일 제한 준수 (최대 5일)

**알고리즘 순서:**
0. 일요일이면 주간 휴일 카운트 리셋
1. 주휴일 배정 (최우선) - 간호사별 지정 요일에 WEEK_OFF 자동 배정 (isFixed: true)
2. 연속 근무일 체크 - 5일 연속 근무한 간호사는 근무 배정 제외
   - 토요일에는 주간 휴일이 0인 간호사도 근무 배정 제외 (OFF 강제)
3. 나이트 근무 배정 (2명) - E, N 다음 또는 첫날
4. 데이 근무 배정 (3명) - 휴일 후 또는 D 연속
5. 중간 근무 배정 (1명) - D, M 다음 또는 첫날
6. 이브닝 근무 배정 (3명) - D, M, E 다음 또는 첫날
7. 나머지 OFF 배정 - 주 후반(수~토)에는 주간 휴일이 0인 간호사 우선 배정
8. 연속 근무일 자동 업데이트 (근무시 +1, 휴일시 리셋)
9. 주간 휴일 카운트 업데이트 (OFF/연차/생휴 배정 시 +1)

#### 2. `src/utils/validator.ts`

**`validateSchedule(schedule, nurses)`**
- 전체 스케줄 검증
- 일일 필수 인원 및 근무 순서 규칙 검증
- 위반 목록 및 일일 근무 상태 반환

**`validateDailyStaffRequirement(date, schedule)`**
- 특정 날짜의 일일 필수 인원 검증
- 각 근무 타입별 부족/충족 확인
- 위반 정보 반환

**`validateShiftOrder(nurseId, nurseName, schedule)`**
- 특정 간호사의 근무 순서 검증
- 역순 근무 감지 (E → D, N → E 등)
- 위반 정보 반환

**`validateConsecutiveWorkDays(nurseId, nurseName, schedule)`**
- 특정 간호사의 연속 근무일 검증
- 최대 5일 연속 근무 제한 확인
- 6일 이상 연속 근무 시 위반 정보 반환
- 휴일(OFF, WEEK_OFF, ANNUAL, MENSTRUAL) 시 카운터 리셋

**`validateWeeklyRest(nurseId, nurseName, schedule)`**
- 특정 간호사의 주간 휴식 규칙 검증
- 각 주(일~토)별로 그룹화하여 검증
  - 주휴일(WEEK_OFF) 정확히 1일 필요
  - 추가 휴일(OFF/ANNUAL/MENSTRUAL) 최소 1일 필요
  - 총 휴일 최소 2일 필요
- 불완전한 주(7일 미만)는 검증 제외
- 위반 정보 반환

#### 3. `src/components/ScheduleView.tsx`

- 스케줄 테이블 렌더링
- 셀 클릭 핸들러 (고정 셀은 클릭 무시)
- 자동 생성 버튼
- 실시간 검증 및 시각적 피드백
- 고정 셀 시각적 표시 (검은 테두리)

#### 4. `src/styles/ScheduleView.css`

- `.shift-cell.fixed`: 고정 셀 스타일 (검은 테두리, cursor: not-allowed)
- `.shift-cell.violation`: 제약 위반 셀 스타일 (빨간 테두리)

---

## 🧪 테스트 규칙

### 테스트 주도 개발 (TDD) 원칙

**🔴 중요: 모든 제약 조건 구현은 반드시 테스트 코드 작성과 통합 테스트 통과를 포함합니다.**

#### 필수 프로세스

**🔴 중요: Claude는 스스로 모든 테스트 코드를 작성하고 통과시켜야 합니다.**

1. **제약 조건 구현 완료**
   - validator.ts에 검증 로직 추가
   - scheduler.ts에 생성 로직 개선 (필요 시)

2. **즉시 테스트 코드 작성 (자동)** ⭐
   - 사용자 요청 없이 **Claude가 스스로** 테스트 코드 작성
   - 해당 제약 조건에 대한 단위 테스트 작성
   - 정상 케이스 + 위반 케이스 모두 테스트
   - 파일 위치: `src/utils/*.test.ts`

3. **개별 테스트 통과 확인** ⭐
   - `npm run test:verbose` 실행
   - 새로 추가한 테스트들이 통과하는지 확인
   - 실패 시 코드 수정 후 재실행

4. **통합 테스트 통과 확인** ⭐
   - 기존의 모든 테스트 + 새 테스트 모두 통과 확인
   - **특히 AND 조건 통합 테스트 통과 필수**
   - violations.length === 0 확인
   - 실패 시 코드 수정 후 3번부터 재실행

5. **문서 업데이트**
   - SPEC.md에 구현 내용 반영
   - 완료된 기능은 ✅로, 진행 중은 🚧로 표시

**⚠️ 이 과정은 자동으로 반복됩니다. 사용자가 요청하지 않아도 Claude가 스스로 수행합니다.**

#### 테스트 기본 세팅

모든 통합 테스트는 다음 기준을 사용합니다:

```typescript
const DEFAULT_NURSE_COUNT = 15;  // 기본 간호사 수
const DEFAULT_START_DATE = '2024-01-01';  // 기본 시작일 (월요일)
const DEFAULT_END_DATE = '2024-01-28';  // 기본 종료일 (4주)
const DEFAULT_DAYS = 28;  // 기본 일수 (4주)
```

#### 통합 테스트 기준

- **AND 조건 테스트**: 모든 하드 제약 조건을 동시에 만족하는지 검증
- **반복 테스트**: 최소 20회 반복 생성하여 랜덤 요소에도 제약 조건 만족 확인
- **다양한 기간 테스트**: 1주, 2주, 3주, 4주 모두 테스트
- **위반 0개**: 통합 테스트에서 violations.length === 0 필수

#### 테스트 파일 구조

```
src/
├── utils/
│   ├── scheduler.ts
│   ├── scheduler.test.ts       # scheduler 단위/통합 테스트
│   ├── validator.ts
│   └── validator.test.ts       # validator 단위 테스트
└── test/
    └── setup.ts                # 테스트 환경 설정
```

#### 테스트 명령어

```bash
# 한 번만 실행 (CI/CD용)
npm run test:run

# 상세 로그로 실행 (각 테스트 성공 여부 확인)
npm run test:verbose

# 감시 모드 (개발 중)
npm run test

# UI 모드 (브라우저에서 보기)
npm run test:ui
```

#### 예시: 나이트 근무 규칙 구현 시

**구현:**
1. ✅ `validator.ts`에 `validateNightShiftRules()` 함수 작성
2. ✅ `scheduler.ts`에 나이트 2-3일 연속 로직 구현

**테스트 (Claude가 자동으로 수행):**
3. ✅ `validator.test.ts`에 나이트 규칙 테스트 추가 (스스로 작성)
   - 2일 연속 정상
   - 3일 연속 정상
   - 1일만 위반
   - 4일 이상 위반
   - 나이트 후 2일 휴식 확인
   - 2주 연속 나이트 금지 확인
4. ✅ `npm run test:verbose` 실행하여 개별 테스트 통과 확인
5. ✅ `scheduler.test.ts`의 AND 조건 통합 테스트 통과 확인
6. ✅ `npm run test:verbose` 실행하여 모든 테스트 통과 (violations.length === 0)

**문서화:**
7. ✅ SPEC.md 업데이트

**⚠️ 3-6번은 사용자가 요청하지 않아도 Claude가 자동으로 수행합니다.**

---

## 🚀 향후 개선 사항

- [ ] Excel 파일 내보내기/가져오기
- [ ] 스케줄 히스토리 관리
- [ ] 근무 통계 대시보드
- [ ] 더 정교한 알고리즘 (백트래킹, 유전 알고리즘 등)
- [ ] 다크 모드 지원
- [ ] 모바일 반응형 UI
- [ ] 알림 기능 (근무 시작 전 알림 등)
- [ ] 데이터 영속성 (로컬 스토리지 또는 백엔드 연동)

---

## 📝 라이선스

MIT License

## 📧 문의

문제가 발생하거나 개선 제안이 있으시면 이슈를 등록해주세요.
