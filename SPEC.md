# 간호사 번표 자동 작성 프로그램 기획서

4주 근무 스케줄 자동 생성 및 관리 시스템

## 📋 프로젝트 개요

간호사 근무표를 자동으로 생성하는 웹 애플리케이션입니다. 다양한 제약 조건을 준수하면서 공평한 근무 배분을 목표로 합니다.

## 📅 주요 개념

### 1주의 정의

**본 프로그램에서 1주는 일요일부터 토요일까지를 의미합니다.**

- **주 시작**: 일요일
- **주 종료**: 토요일
- **주간 휴식 규칙**: 일~토 기준으로 계산
- **주휴일**: 각 간호사가 지정한 요일 (일~토 중 1일)

이는 일반적인 월~일 기준과 다르므로 주의가 필요합니다.

## 🛠 기술 스택

- **Frontend**: React 19.1.1 + TypeScript
- **Build Tool**: Vite
- **Styling**: CSS

## 🚀 실행 방법

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 빌드
npm run build
```

---

## 💡 주요 기능

### 1. 간호사 관리

- 간호사 추가/수정/삭제
- 개인별 주휴일(요일) 설정
- 초기 15명 세팅 (주휴일 라운드로빈 배정)

### 2. 스케줄 관리

- 시작일/종료일 설정 (동적 일수 계산)
- **셀 클릭**: 근무 타입 변경 (D → M → E → N → OFF → 주휴 → 연차)
- **셀 우클릭**: 고정/고정 해제 (고정된 셀은 검은 테두리 표시)
- 날짜별 근무 인원 실시간 표시 (색상으로 부족/충족/초과 표시)

### 3. 자동 생성

- 제약 조건을 만족하는 스케줄 자동 생성
- 공평한 근무 분배 알고리즘
- 고정된 셀은 유지하고 나머지만 재배정

### 4. 제약 조건 검증

- 실시간 제약 조건 위반 감지
- 하드 제약/소프트 제약 구분 표시
- 위반 내역 상세 보기 (더보기/접기 기능)

---

## 📐 제약 조건

### 🔴 하드 제약 조건 (반드시 지켜야 함)

#### 1. 일일 필수 인원

각 근무조별 필수 인원을 반드시 충족해야 합니다.

- **D (데이)**: 3명 필수
- **M (중간)**: 1명 필수
- **E (이브닝)**: 3명 필수
- **N (나이트)**: 2명 필수
- **총 9명**의 근무자 필요

#### 2. 근무 순서 규칙

근무는 정해진 순서를 따라야 하며, 역순은 불가합니다.

- **허용되는 순서**: D → M → E → N → 휴일
- 같은 근무 연속 가능 (예: D → D → D)
- 건너뛰기 가능 (예: D → E, M → N)
- ❌ **역순 불가** (예: E → D, N → E, E → M 불가)
- 휴일 후에도 순서대로 근무 가능
- 예를 들어, 휴일 -> E -> N 가능
- 예를 들어, 휴일 -> D -> E 가능. 순서를 지켜야 한다.

#### 3. 나이트 근무 규칙

나이트 근무는 특별한 규칙을 따릅니다.

- **2일 또는 3일 연속**만 가능 (1일만 또는 4일 이상 불가)
- 나이트 1일차 후: 반드시 2일차 계속
- 나이트 2일차 후: 3일차 계속 또는 휴식
  - 알고리즘에서 70% 확률로 3일차 진행
- 나이트 3일차 후: 반드시 휴식
- 나이트 근무 후 **2일 이상 연속 휴식** 필수
- **2주 연속 나이트 근무 금지**
  - 이번 주 나이트 → 다음 주는 나이트 불가

#### 4. 연속 근무일 제한

과도한 연속 근무를 방지합니다.

- 최대 **5일 연속 근무**까지만 가능
- 6일 이상 연속 근무 불가

#### 5. 주간 휴식 규칙 (일~토 기준)

매주 적절한 휴식을 보장합니다.

- **주휴(WEEK_OFF)**: 정확히 1일 (본인 지정 요일)
- **총 휴일**: 최소 2일 이상 (주휴 1일 + OFF 1일 이상)

#### 6. 고정 근무/휴가

사용자가 수동으로 설정한 일정은 보호됩니다.

- 사용자가 우클릭으로 고정한 셀은 자동 생성 시 변경되지 않음
- 연차(ANNUAL), 생리휴가(MENSTRUAL) 등 고정 가능 // TODO 확인 필요

---

### 🟡 소프트 제약 조건 (권장사항)

#### 1. 비권장 패턴

- **E → OFF → D** 패턴 비권장
  - 가능은 하지만 권장하지 않음

#### 2. 휴일 공평 분배

간호사들 간의 휴일 수 차이를 최소화합니다.

- 간호사별 총 휴일 수 차이 최대 1일 이내 권장
- 차이 2일: 소프트 위반
- 차이 3일 이상: 하드 위반

#### 3. 근무 공평 분배

근무 부담을 균등하게 분산합니다.

- 총 근무일이 적은 간호사 우선 배정
- 근무 부담이 특정 간호사에게 쏠리지 않도록 조정

---

## 🔄 스케줄 생성 알고리즘

### 배정 순서

스케줄은 다음 순서로 생성됩니다:

1. **고정된 셀 유지**
   - `isFixed=true`인 셀은 변경 안 함

2. **나이트 연속 처리**
   - 이미 나이트 중인 간호사 우선 처리

3. **새로운 나이트 배정**
   - 2명, 제약 조건 만족하는 간호사 중 근무일 적은 순

4. **데이 배정**
   - 3명

5. **중간 배정**
   - 1명, D 또는 M 다음만 가능

6. **이브닝 배정**
   - 3명, D, M, E 다음만 가능

7. **나머지는 휴일**
   - 주휴일 자동 배정

### 공평 분배 메커니즘

- `totalWorkDays` 추적: 각 간호사의 총 근무일 수 계산
- 근무 배정 시 `totalWorkDays`가 적은 간호사 우선 선택
- 모든 근무 타입(D, M, E, N)에 동일하게 적용

### 제약 조건 검증

- 실시간으로 제약 조건 위반 여부 검증
- 하드 제약 위반 우선 표시
- 위반 내역: 간호사명, 날짜, 사유 상세 표시

---

// TODO 고정 가능한 근무 타입 확인 필요
## 📊 근무 타입

| 타입      | 한글명 | 설명                   | 우선순위 |
| --------- | ------ | ---------------------- | -------- |
| D         | 데이   | 주간 근무              | 1        |
| M         | 중간   | 중간 근무 (선택적)     | 2        |
| E         | 이브닝 | 저녁 근무              | 3        |
| N         | 나이트 | 야간 근무 (2-3일 연속) | 4        |
| OFF       | 오프   | 일반 휴무              | -        |
| WEEK_OFF  | 주휴   | 주휴일 (지정 요일)     | -        |
| ANNUAL    | 연차   | 연차 휴가              | -        |
| MENSTRUAL | 생휴   | 생리 휴가              | -        |

---

## 📁 파일 구조

```
src/
├── types.ts                    # 타입 정의
├── constants.ts                # 상수 정의 (일일 필요 인원, 근무 타입 등)
├── App.tsx                     # 메인 앱 (탭 관리)
├── App.css                     # 전역 스타일
├── components/
│   ├── NurseManagement.tsx     # 간호사 관리 UI
│   └── ScheduleView.tsx        # 스케줄 뷰 UI
└── utils/
    ├── scheduler.ts            # 스케줄 생성 알고리즘
    └── validator.ts            # 제약 조건 검증
```

---

## 📖 사용 방법

### 1. 간호사 등록

1. "간호사 관리" 탭으로 이동
2. 간호사 이름 입력 및 주휴일 선택
3. "추가" 버튼 클릭
4. **수정**: "수정" 버튼 클릭 후 정보 변경 → "저장"
5. **삭제**: "삭제" 버튼 클릭

### 2. 스케줄 생성

1. "스케줄 관리" 탭으로 이동
2. 시작일/종료일 설정
3. 고정할 근무/휴가가 있다면:
   - 셀 클릭으로 근무 타입 변경
   - 우클릭으로 고정 (검은 테두리 표시)
4. "자동 생성" 버튼 클릭
5. 생성된 스케줄 확인 및 제약 조건 위반 확인

### 3. 수동 조정

- **셀 클릭**: 근무 타입 순환 변경
- **셀 우클릭**: 고정/해제 토글
- 고정된 셀은 자동 생성 시 변경되지 않음

---

## 🔧 개발 정보

### 구현 상태

#### ✅ 완료된 기능

1. **간호사 관리**
   - 추가/삭제 기능
   - 이름 및 주휴일 인라인 수정
   - 기본 15명 세팅 (주휴일 라운드로빈)

2. **스케줄 테이블 UI**
   - 날짜별 간호사 근무 배정
   - 셀 클릭으로 근무 타입 순환 변경
   - 간호사별/날짜별 통계 표시
   - 주말 표시 (빨간색)

3. **자동 생성 기능**
   - 일일 필수 인원 충족 (D: 3, M: 1, E: 3, N: 2)
   - 근무 순서 규칙 준수 (D → M → E → N)
   - 공평한 근무 분배 (근무 횟수 기반)
   - 매번 다른 스케줄 생성 (랜덤 요소)

4. **제약 조건 검증**
   - 일일 필수 인원 검증 (색상 표시: 부족/충족/초과)
   - 근무 순서 규칙 검증 (역순 방지)
   - 연속 근무일 제한 검증 (최대 5일 연속 근무)
   - 위반 셀 시각적 표시 (빨간 테두리)
   - 툴팁으로 위반 내용 표시

5. **자동 생성 개선**
   - 연속 근무일 제한 준수 (최대 5일)
   - 5일 연속 근무 시 자동으로 휴식 배정
   - 연속 근무일 추적 및 자동 리셋

#### 🚧 구현 예정

1. **나이트 근무 규칙 검증**
   - 2-3일 연속 규칙
   - 나이트 후 2일 휴식
   - 2주 연속 나이트 금지

2. **주간 휴식 규칙 검증**
   - 주휴일 1일 + OFF 1일 이상

3. **고정 셀 기능**
   - 우클릭으로 고정/해제
   - 자동 생성 시 고정 셀 유지

### 주요 파일 및 함수

#### 1. `src/utils/scheduler.ts`

**`generateSimpleSchedule(nurses, startDate, endDate)`**
- 간단한 자동 스케줄 생성
- 일일 필수 인원 충족
- 근무 순서 준수 (D → M → E → N)
- 공평한 근무 분배 (근무 카운트 기반)
- 연속 근무일 제한 준수 (최대 5일)

**알고리즘 순서:**
1. 연속 근무일 체크 - 5일 연속 근무한 간호사는 근무 배정 제외
2. 나이트 근무 배정 (2명) - E, N 다음 또는 첫날
3. 데이 근무 배정 (3명) - 휴일 후 또는 D 연속
4. 중간 근무 배정 (1명) - D, M 다음 또는 첫날
5. 이브닝 근무 배정 (3명) - D, M, E 다음 또는 첫날
6. 나머지 OFF 배정
7. 연속 근무일 자동 업데이트 (근무시 +1, 휴일시 리셋)

#### 2. `src/utils/validator.ts`

**`validateSchedule(schedule, nurses)`**
- 전체 스케줄 검증
- 일일 필수 인원 및 근무 순서 규칙 검증
- 위반 목록 및 일일 근무 상태 반환

**`validateDailyStaffRequirement(date, schedule)`**
- 특정 날짜의 일일 필수 인원 검증
- 각 근무 타입별 부족/충족 확인
- 위반 정보 반환

**`validateShiftOrder(nurseId, nurseName, schedule)`**
- 특정 간호사의 근무 순서 검증
- 역순 근무 감지 (E → D, N → E 등)
- 위반 정보 반환

**`validateConsecutiveWorkDays(nurseId, nurseName, schedule)`**
- 특정 간호사의 연속 근무일 검증
- 최대 5일 연속 근무 제한 확인
- 6일 이상 연속 근무 시 위반 정보 반환
- 휴일(OFF, WEEK_OFF, ANNUAL, MENSTRUAL) 시 카운터 리셋

#### 3. `src/components/ScheduleView.tsx`

- 스케줄 테이블 렌더링
- 셀 클릭 핸들러
- 자동 생성 버튼
- 실시간 검증 및 시각적 피드백

---

## 🚀 향후 개선 사항

- [ ] Excel 파일 내보내기/가져오기
- [ ] 스케줄 히스토리 관리
- [ ] 근무 통계 대시보드
- [ ] 더 정교한 알고리즘 (백트래킹, 유전 알고리즘 등)
- [ ] 다크 모드 지원
- [ ] 모바일 반응형 UI
- [ ] 알림 기능 (근무 시작 전 알림 등)
- [ ] 데이터 영속성 (로컬 스토리지 또는 백엔드 연동)

---

## 📝 라이선스

MIT License

## 📧 문의

문제가 발생하거나 개선 제안이 있으시면 이슈를 등록해주세요.
